<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Exkoo CRM - Appointment Preview</title>

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&display=swap"
      rel="stylesheet"
    />
    <script src="https://unpkg.com/@tailwindcss/browser@4"></script>

    <style>
      body {
        font-family: "Poppins", sans-serif;
      }
    </style>
  </head>
  <body
    class="bg-gray-100 p-6 flex flex-col justify-center items-center h-screen w-screen"
  >
    <div
      class="w-full max-w-lg bg-white rounded-lg shadow-md p-6 flex flex-col gap-6 overflow-y-scroll"
    >
      <!-- Profile Section -->
      <div class="flex items-center gap-2">
        <img
          src="<%= bookingData.profileLogo %>"
          alt="Profile"
          class="w-12 h-12 rounded-full object-cover"
        />
        <div class="flex flex-col">
          <h2 class="text-lg font-semibold">
            <%= bookingData.bookingPageTitle %>
          </h2>
          <p class="text-gray-500 text-sm">
            <%= bookingData.bookingPageIntro %>
          </p>
        </div>
      </div>

      <!-- Dynamic Form -->
      <form id="dynamicForm" class="space-y-2">
        <div id="formContainer" class="grid grid-cols-2 gap-4"></div>

        <!-- Submit Button -->
        <div class="flex justify-end gap-2">
          <button
            type="button"
            onclick="window.history.back()"
            class="bg-gray-300 px-4 py-2 rounded text-gray-700 text-xs"
          >
            Back
          </button>

          <button
            type="submit"
            class="bg-blue-600 px-4 py-2 rounded text-white text-xs"
          >
            Confirm Booking
          </button>
        </div>
      </form>

      <!-- Footer -->
      <div class="text-center text-gray-500 text-xs">
        Powered by <a href="#" class="text-blue-500 font-semibold">Exkoo</a>
      </div>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const bookingData = <%- JSON.stringify(bookingData || {}) %>; // Ensure it is not undefined
        const formContainer = document.getElementById("formContainer");

        if (!bookingData.bookingQuestion) {
          console.error("No booking questions available.");
          return;
        }

        bookingData.bookingQuestion.forEach(question => {
          const fieldWrapper = document.createElement("div");
          fieldWrapper.classList.add("w-full");

          if (question.size === "50%") {
            fieldWrapper.classList.add("col-span-1");
          } else {
            fieldWrapper.classList.add("col-span-2");
          }

          // Label
          const label = document.createElement("label");
          label.setAttribute("for", question.shortCode);
          label.classList.add("text-gray-700", "text-xs");
          label.textContent = question.label;
          if (question.required) {
            label.innerHTML += ' <span class="text-red-500">*</span>';
          }

          let input;
          if (["TEXT", "EMAIL", "TEL"].includes(question.type)) {
            input = document.createElement("input");
            input.type = question.type.toLowerCase();
            input.placeholder = question.placeholder || "";
            input.value = question.defaultValue || "";
          } else if (question.type === "SELECT" && question.options.fields.length) {
            input = document.createElement("select");
            question.options.fields.forEach(option => {
              const optionElement = document.createElement("option");
              optionElement.value = option;
              optionElement.textContent = option;
              input.appendChild(optionElement);
            });
          }

          input.id = question.shortCode;
          input.name = question.shortCode;
          input.required = question.required;
          input.classList.add("w-full", "p-2", "border", "rounded", "outline-none", "text-xs");

          // Append elements
          fieldWrapper.appendChild(label);
          fieldWrapper.appendChild(input);
          formContainer.appendChild(fieldWrapper);
        });
      });
    </script>
  </body>
</html>
